<!doctype html><html lang=en data-theme=dark><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>How we solved the Quectel RN520G stability problems in combination with a Raspberry Pi - ZERO GmbH Tech Blog</title>
<meta name=description content="We have written about the Quectel RM520N-GL 5G cellular modem before. Back then it was about setting up the software to establish a functioning Internet connection under Linux.
Now there is another article about the modem - but not because everything worked as intended straight away. Rather, this time we want to give you an insight into our daily struggle with and against technology. Because not everything that should work actually works in the end. Even if - as in this case - the electronics have already been used successfully in one way or another."><link rel=icon type=image/x-icon href=https://blog.zero-iee.com/favicon.ico><link rel=apple-touch-icon-precomposed href=https://blog.zero-iee.com/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><script defer data-domain=blog.zero-iee.com src=https://analytics.zero-iee.com/js/script.js></script><link rel=stylesheet href=https://blog.zero-iee.com/css/style.min.930d4b2abd5c36f0b4decc538651a976d4e2c8f2f5c29312c354f3ca383468ae.css integrity="sha256-kw1LKr1cNvC03sxThlGpdtTiyPL1wpMSw1Tzyjg0aK4="><script src=https://blog.zero-iee.com/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><meta property="og:url" content="https://blog.zero-iee.com/en/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/"><meta property="og:site_name" content="ZERO GmbH Tech Blog"><meta property="og:title" content="How we solved the Quectel RN520G stability problems in combination with a Raspberry Pi"><meta property="og:description" content="We have written about the Quectel RM520N-GL 5G cellular modem before. Back then it was about setting up the software to establish a functioning Internet connection under Linux.
Now there is another article about the modem - but not because everything worked as intended straight away. Rather, this time we want to give you an insight into our daily struggle with and against technology. Because not everything that should work actually works in the end. Even if - as in this case - the electronics have already been used successfully in one way or another."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-19T10:00:00+02:00"><meta property="article:modified_time" content="2024-04-19T10:00:00+02:00"><meta property="article:tag" content="Mobilfunk"><meta property="article:tag" content="Connectivity"><meta property="article:tag" content="5g"><meta property="article:tag" content="SmartCity"><meta property="article:tag" content="Quectel"><meta property="article:tag" content="Raspberrypi"><meta name=twitter:card content="summary"><meta name=twitter:title content="How we solved the Quectel RN520G stability problems in combination with a Raspberry Pi"><meta name=twitter:description content="We have written about the Quectel RM520N-GL 5G cellular modem before. Back then it was about setting up the software to establish a functioning Internet connection under Linux.
Now there is another article about the modem - but not because everything worked as intended straight away. Rather, this time we want to give you an insight into our daily struggle with and against technology. Because not everything that should work actually works in the end. Even if - as in this case - the electronics have already been used successfully in one way or another."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><div class=header-logo></div><h1 class=site-title><a href=/en>ZERO GmbH Tech Blog</a></h1><ul class=social-icons><li><a href=https://techhub.social/@zeroiee title=Mastodon rel=me><span class=inline-svg><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a></li><li><a href=https://github.com/zero-iee title=Github rel=me><span class=inline-svg><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://de.linkedin.com/company/zero-iee title=Linkedin rel=me><span class=inline-svg><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li></ul></div><nav></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">How we solved the Quectel RN520G stability problems in combination with a Raspberry Pi</h1><span><ul class=post-translations><li><a href=https://blog.zero-iee.com/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/>DE</a></li><li>EN</li></ul></span></header></div><div class="content e-content"><p>We have written about the Quectel RM520N-GL 5G cellular modem <a href=https://blog.zero-iee.com/posts/quectel-rm520n-and-telit-fn990a28-5g-modems-on-raspberrypi-os/>before</a>. Back then it was about setting up the software to establish a functioning Internet connection under Linux.</p><p>Now there is another article about the modem - but not because everything worked as intended straight away. Rather, this time we want to give you an insight into our daily struggle with and against technology. Because not everything that <em>should</em> work actually works in the end. Even if - as in this case - the electronics have already been used successfully in one way or another.</p><p>For one customer project, we had already successfully selected components that met the customer&rsquo;s stringent requirements: a Raspberry Pi 4 was to form the basis for a mini-computer that was to be connected to the mobile network via a 5G-capable modem. The special feature: as it was to be a <em>mobile</em> mini-computer, there were clear specifications regarding the power supply. The computer was to be powered by a rechargeable battery.</p><p>As mentioned at the beginning, we had already successfully used the modem and were surprised when no mobile connection could be established when the parts were plugged together. We considered the following possible causes:</p><ol><li>poor reception at this point in our offices? On the other hand, we had already successfully tested other mobile radio setups here.</li><li>poor reception due to too small antennas? Due to the size restrictions, we had to use relatively small antennas. However, larger antennas were of no use in experiments.</li><li>possible interference of the antennas by the very close positioned Raspberry Pi or other electronics? However, even equalization of the compact original setup did not bring about any improvement.</li><li>possible interference with the USB due to a plugged-in USB stick? In the recent past, we have experienced this mainly in conjunction with USB3 and USB sticks of inferior quality. But unplugging the USB stick didn&rsquo;t help either.</li></ol><p>Finally, a look at the kernel log revealed why no connection could be established: The kernel reported the Quectel modem logging on and off the USB at irregular intervals. In between, several error messages appeared because the modem was not responding to the commands of the modem software as expected.</p><p>We feared we were dealing with a USB fault that was difficult to rectify when we started making comparisons with another Quectel setup. In our original setup, we used a USB M.2 adapter from a manufacturer that still marked this as &ldquo;Experimental&rdquo;. In order to be able to compare with a guaranteed working reference, we plugged in our Quectel Evaluation Kit instead. In principle, this also consists of a USB-to-M.2 adapter and some onboard antennas. We also plugged the modem itself into the Quectel board from the EK to rule it out as a source of error.</p><p>The result: flawless reception, stable pings. No connection interruptions on the USB bus. So the USB M.2 board from the other manufacturer was targeted early on. However, we have not yet been able to identify the exact cause.</p><p>A few experiments later, the Quectel mobile modem was screwed back into its original adapter board. In the meantime, it had become clear that the USB connection collapsed mainly when the modem was being used. For example, after starting the modem or when it was tasked with searching for a network or establishing a connection to a mobile network. This smelled like a power problem. Finally, the split power supply for the Raspi and modem provided valuable confirmation: If we supplied the two units with two independent batteries via a Y-cable (on the M.2 board), the modem ran flawlessly. Not only was a robust connection established, but the reception was also noticeably better.</p><p>The modem obviously needed a little more power than a single battery could handle. We tested this with a powerful power supply unit, which should now supply the Raspberry Pi and the modem connected to it with sufficient power. The power supply was set to 5V and a current limit of 6A. The modem&rsquo;s data sheet speaks of a short-term maximum current consumption of up to 5A. Maybe our battery was not strong enough?</p><p>We were disillusioned to discover that even the powerful power supply unit did not bring any improvement. But what was the problem? We now had a robust power supply after all! To be on the safe side, we also excluded the Raspi&rsquo;s USB ports as a source of error. These only allow a current of 600 mA by default. This limitation can be removed via a <a href=https://www.elektronik-kompendium.de/sites/raspberry-pi/2206111.htm>setting</a> in <code>config.txt</code>, but we decided to supply the modem directly via solder contacts on the M.2 board and a connection to the 5V header pin. Unfortunately, even removing the USB from the power supply path did not bring the hoped-for success.</p><p>A little later and much more perplexed, we pulled out the oscilloscope and decided to measure the voltage levels more precisely at various points in our setup:</p><ul><li>Directly at the cellular modem (4V) - blue</li><li>At the Raspberry Pi header (5V) - yellow</li><li>At the Raspi voltage input / power supply (5V) - purple</li></ul><p>This is the result:</p><p><img alt="Oszilloskop zeigt Kurven mit Spannungseinbrüchen an allen drei Messstellen" src=/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/images/RigolDS0_via_USB_ohne_Kondensatoren.png></p><p>As can be clearly seen in all three curves, a certain amount of flickering determines the picture. The voltage is by no means stable when the modem is under load, but fluctuates by up to 1 V in some cases. The voltage drop directly at the mobile radio modem is particularly severe. This is because a voltage converter is connected upstream of the modem (on the M.2 board), which suddenly &ldquo;kinks&rdquo; under the sudden current demand or switches off briefly as soon as it no longer detects a sufficiently high voltage at its input. Finally, the cell modem kinks and restarts itself - hence the disconnect that we observed on the USB. The unsteadiness in the voltage curve runs through the chain to the power supply unit, as can be clearly seen. With decreasing intensity, but still clearly.</p><p>Although since the Raspberry Pi 4 <em>no</em> <a href=https://learn.watterott.com/de/raspberrypi/troubleshooting/>Polyfuse</a> has been connected between the USB Power In and 5V rail, which could cause the voltage level on the 5V rail to collapse due to its resistance, we have observed a slight voltage drop between the 5V header pin (yellow) and the USB-C Power In connection. This could possibly be due to the resistance of the conductor tracks on the Raspi board - as these are not necessarily designed for high currents.</p><p>We now realized why we had a power problem in the first place and why a single (but powerful!) power supply at this point could not solve the problem. As a makeshift solution, we started experimenting with capacitors at various points:</p><ul><li>At the 4V supply voltage to the cellular modem</li><li>At the 5V Raspberry Pi header</li><li>At the 5V input of the Raspberry Pi</li></ul><p>There was a noticeable improvement when we stabilized the 5V USB supply for the M.2 adapter at the pins on the Raspi header. We chose a 1000 uF electrolytic capacitor for this:</p><p><img alt="Oscilloscope shows clearly stabilized voltage line for the header" src=/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/images/RigolDS1_via_USB_Kondensator_Raspi_header_5V.png></p><p>However, we were only able to prevent the M.2 voltage converter from failing at 4V when we integrated additional capacitors at the 4V supply of the modem and the 5V input of the Rapsberry Pi:</p><p><img alt="Oscilloscope shows further stabilized lines also for input and header measuring points" src=/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/images/RigolDS2_via_USB_Kondensator_Raspi_und_M2_4V.png></p><p>Now, however, another symptom appeared: Our measures had created another problem: The kernel&rsquo;s hardware manager complained in red letters about an &ldquo;undervoltage!&rdquo;. The sudden power demand and the recharging of the capacitors were probably too much for the Raspi traces. Not enough to reset the Raspi, but we took the warning seriously and didn&rsquo;t want to take any risks. Stable operation at the customer&rsquo;s site is extremely important to us.</p><p>To eliminate the problem, we therefore decided to no longer supply the Raspi and the M.2 add-on board with power via USB-C, but via the Raspi header or via soldered contacts directly on the M.2 board. From here, both the M.2 board and the Raspi could draw the power over a short distance - the current peaks of the mobile radio module no longer had to be routed via the Raspi tracks.</p><p><img alt="Oscilloscope shows a very smooth voltage curve for the Raspi header and modem measurement points" src=/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/images/RigolDS3_via_Header_mit_Kondensatoren_uns_.png></p><p>With the capacitors and the more centralized power supply, our setup worked perfectly! No more USB crashes and the kernel no longer issued any voltage warnings. But the best thing was: The capacitors turned out to be unnecessary from then on:</p><p>The voltage curves are a bit rougher without capacitors than before, but still stable enough not to cause any errors on the modem or microprocessor.</p><p><strong>All that was needed to solve our problem was a power supply via the Raspi header (instead of via the Raspi&rsquo;s USB-C socket) and a direct power supply to the cell modem</strong></p><p>The problem was apparently that the traces on the Raspi are probably not designed for the peak currents generated by the cellular modem and its voltage converter, so that the modem should not be supplied via the Raspi, but directly on the M.2 board.</p></div><div class=post-info>By Thomas Leister<div class="post-date dt-published">2024-04-19</div><a class="post-hidden-url u-url" href=https://blog.zero-iee.com/en/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/>https://blog.zero-iee.com/en/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/</a>
<a href=https://blog.zero-iee.com/ class="p-name p-author post-hidden-author h-card" rel=me>Thomas Leister</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://blog.zero-iee.com/en/tags/mobilfunk/>#Mobilfunk</a></li><li><a href=https://blog.zero-iee.com/en/tags/connectivity/>#Connectivity</a></li><li><a href=https://blog.zero-iee.com/en/tags/5g/>#5g</a></li><li><a href=https://blog.zero-iee.com/en/tags/smartcity/>#SmartCity</a></li><li><a href=https://blog.zero-iee.com/en/tags/quectel/>#Quectel</a></li><li><a href=https://blog.zero-iee.com/en/tags/raspberrypi/>#Raspberrypi</a></li></ul></div></div></article></main><footer class=common-footer><ul class=language-select><li><a href=https://blog.zero-iee.com/posts/quectel-rn520g-stabilitaetsprobleme-raspberry-pi/>Deutsch</a></li><li>English</li></ul><div class=common-footer-bottom><div class=copyright><p>© ZERO GmbH, ZERO GmbH Team, 2024 | <a href=/impressum/>Imprint</a> | <a href=/datenschutz/>Privacy</a><br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, Markdown and Git<br>Theme <a target=_blank rel="noopener noreferrer" href=https://github.com/zero-iee/hugo-theme-anubis-zero>Anubis ZERO</a> based on <a href=https://github.com/Mitrichius/hugo-theme-anubis>Mitrichius/hugo-theme-anubis</a>.<br></p></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="dark-without-switcher";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton&&(switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme")}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href=https://blog.zero-iee.com/ class="p-name u-url url fn" rel=me>ZERO GmbH Team</a></p></footer><a rel=me href=https://techhub.social/@zeroiee style=display:none>Mastodon</a></div></body></html>