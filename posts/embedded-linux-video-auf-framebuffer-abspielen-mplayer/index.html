<!doctype html><html lang=de-de data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Embedded Linux: Video in Endlosschleife auf Framebuffer abspielen mit mplayer - ZERO GmbH Tech Blog</title><meta name=description content="Vor allem für Demozwecke, z.B. auf Messen, fragen Kunden immer wieder nach Displayansteuerungen, die eine Videodatei auf einem oder mehreren Bildschirmen präsentieren. Während sich zum Teil abenteuerliche Lösungen mit Windows und automatisch startenden PowerPoint-Präsentationen mit eingebettetem Video finden lassen, waren wir von ZERO auf der Suche nach einer eleganteren Lösung, die zudem zügig startet und wenig Raum für Fehlbedienung lässt."><link rel=icon type=image/x-icon href=https://blog.zero-iee.com/favicon.ico><link rel=apple-touch-icon-precomposed href=https://blog.zero-iee.com/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=https://blog.zero-iee.com/css/style.min.fc9ebcfe9b1b09e99acb9ddd1b05ca6ef79afbb98b11d05cf308293975b32d43.css integrity="sha256-/J68/psbCemay53dGwXKbvea+7mLEdBc8wgpOXWzLUM="><script src=https://blog.zero-iee.com/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><meta property="og:title" content="Embedded Linux: Video in Endlosschleife auf Framebuffer abspielen mit mplayer"><meta property="og:description" content="Vor allem für Demozwecke, z.B. auf Messen, fragen Kunden immer wieder nach Displayansteuerungen, die eine Videodatei auf einem oder mehreren Bildschirmen präsentieren. Während sich zum Teil abenteuerliche Lösungen mit Windows und automatisch startenden PowerPoint-Präsentationen mit eingebettetem Video finden lassen, waren wir von ZERO auf der Suche nach einer eleganteren Lösung, die zudem zügig startet und wenig Raum für Fehlbedienung lässt."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.zero-iee.com/posts/embedded-linux-video-auf-framebuffer-abspielen-mplayer/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-21T02:38:26-08:00"><meta property="article:modified_time" content="2022-12-21T02:38:26-08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Embedded Linux: Video in Endlosschleife auf Framebuffer abspielen mit mplayer"><meta name=twitter:description content="Vor allem für Demozwecke, z.B. auf Messen, fragen Kunden immer wieder nach Displayansteuerungen, die eine Videodatei auf einem oder mehreren Bildschirmen präsentieren. Während sich zum Teil abenteuerliche Lösungen mit Windows und automatisch startenden PowerPoint-Präsentationen mit eingebettetem Video finden lassen, waren wir von ZERO auf der Suche nach einer eleganteren Lösung, die zudem zügig startet und wenig Raum für Fehlbedienung lässt."></head><body><a class=skip-main href=#main>Zum Hauptinhalt springen</a><div class=container><header class=common-header><div class=header-top><div class=header-logo></div><h1 class=site-title><a href=/>ZERO GmbH Tech Blog</a></h1><ul class=social-icons></ul></div><nav></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Embedded Linux: Video in Endlosschleife auf Framebuffer abspielen mit mplayer</h1></header></div><div class="content e-content"><p>Vor allem für Demozwecke, z.B. auf Messen, fragen Kunden immer wieder nach Displayansteuerungen, die eine Videodatei auf einem oder mehreren Bildschirmen präsentieren. Während sich zum Teil abenteuerliche Lösungen mit Windows und automatisch startenden PowerPoint-Präsentationen mit eingebettetem Video finden lassen, waren wir von ZERO auf der Suche nach einer eleganteren Lösung, die zudem zügig startet und wenig Raum für Fehlbedienung lässt.</p><p>Zentraler Bestandteil in unserem Ubuntu-basierten Setup ist der <code>mplayer</code> - ein Videoplayer, der seinen Videoutput nicht nur in einer grafischen Desktopumgebung einbetten kann, sondern diesen auch ganz ohne GUI direkt auf den Framebuffer schreiben kann. So können wir auf das Laden einer Xorg- oder Wayland-basierten Desktupumgebung verzichten und beschlenigen den Bootprozess deutlich. Zudem entstehen keine Hürden wie Login oder automatisch startende Applikationen, die das Video verdecken (z.B. der Ubuntu Softwareupdatedienst).</p><p>Der <code>mplayer</code> kann aus den Standardpaketquellen von Ubuntu bezogen werden:</p><pre><code>apt update
apt install mplayer
</code></pre><p>Nach der Installation wird unter <code>/opt/runvideo.sh</code> ein Script angelegt, das <code>mplayer</code> mit einigen Parametern startet:</p><pre tabindex=0><code>#!/bin/bash
VIDEOFILE=$(find /home/showdisplay/Videos/ -type f  -print -quit)
mplayer -vo sdl:driver=fbcon ${VIDEOFILE} -loop 0
</code></pre><p>In der zweiten Zeile wird die erste Videodatei ermittelt, die sich im Verzeichnis <code>/home/showdisplay/Videos</code> befindet (nach alphabetischer Reihenfolge). In Zeile 3 passiert dann die eigentliche <code>mplayer</code>-Magie:</p><ul><li><code>-vo sdl:driver=fbcon</code>: Video auf dem Framebuffer wiedergeben</li><li><code>-loop 0</code>: Das Video in einer Endlosschleife abspielen. <strong>WICHTIG: Dieser Parameter muss an letzter Stelle stehen - sonst startet nicht nur das Video neu, sondern die gesamte <code>mplayer</code> Instanz. Das führt zu einem deutlichen Flackern beim Neustart. Das Verhalten ist nicht dokumentiert. Deshalb sei hiermit explizit darauf hingewiesen.</strong></li></ul><p>Das Startscript wird nun noch ausführbar gemacht:</p><pre><code>chmod u+x /opt/runvideo.sh
</code></pre><p>&mldr; und eine <code>systemd</code> Servicedatei wird erstellt, um das Script beim Boot automatisch auszuführen:</p><pre tabindex=0><code>[Unit]
Description=Run video
ConditionPathExists=/opt/runvideo.sh

[Service]
Type=forking
ExecStart=/opt/runvideo.sh
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes
SysVStartPriority=99

[Install]
WantedBy=multi-user.target
</code></pre><p>Zuletzt wird der neue Service aktiviert:</p><pre><code>systemctl daemon-reload
systemctl enable runvideo.service
</code></pre><p>Da keine GUI benötigt wird (bzw. in diesem Fall sogar stört), wird der Gnome Desktop Manager (GDM) deaktiviert:</p><pre><code>sudo systemctl disable gdm
</code></pre><p>Fertig!</p><p>Sobald der Displaycontroller neu gestartet wird, wird die erste Videodatei aus <code>/home/showdisplay/Videos/</code> abgespielt - zumindest, solange das Format vom <code>mplayer</code> unterstützt wird.</p></div><div class=post-info><div class="post-date dt-published">2022-12-21</div><a class="post-hidden-url u-url" href=https://blog.zero-iee.com/posts/embedded-linux-video-auf-framebuffer-abspielen-mplayer/>https://blog.zero-iee.com/posts/embedded-linux-video-auf-framebuffer-abspielen-mplayer/</a>
<a href=https://blog.zero-iee.com class="p-name p-author post-hidden-author h-card" rel=me>Thomas Leister &lt;thomas.leister@zero-iee.com></a><div class=post-taxonomies><ul class=post-tags><li><a href=https://blog.zero-iee.com/tags/linux/>#linux</a></li><li><a href=https://blog.zero-iee.com/tags/embedded/>#embedded</a></li><li><a href=https://blog.zero-iee.com/tags/video/>#video</a></li><li><a href=https://blog.zero-iee.com/tags/mplayer/>#mplayer</a></li><li><a href=https://blog.zero-iee.com/tags/ubuntu/>#ubuntu</a></li></ul></div></div></article></main><footer class=common-footer><ul class=language-select><li>Deutsch</li><li><a href=https://blog.zero-iee.com/en/>English</a></li></ul><div class=common-footer-bottom><div class=copyright><p>© ZERO GmbH, 2022 | <a href=/impressum/>Impressum</a> | <a href=/datenschutz/>Datenschutz</a><br>Erstellt mit <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, Markdown and Git<br>Theme <a target=_blank rel="noopener noreferrer" href=https://github.com/zero-iee/hugo-theme-anubis-zero>Anubis ZERO</a> basierend auf <a href=https://github.com/Mitrichius/hugo-theme-anubis>Mitrichius/hugo-theme-anubis</a>.<br></p></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="light-without-switcher";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton&&(switchButton.textContent=currentTheme=="dark"?"Helles Theme":"Dunkles Theme")}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href=https://blog.zero-iee.com class="p-name u-url url fn" rel=me></a></p></footer></div></body></html>