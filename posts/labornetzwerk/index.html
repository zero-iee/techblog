<!doctype html><html lang=de data-theme=dark><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Ein Labornetzwerk unter Linux einrichten - ZERO GmbH Tech Blog</title><meta name=description content="Während meiner Arbeit verbinde ich mich regelmäßig zu verschiedenen Rechnern und eingebetteten Geräten, die über eine Ethernetverbindung erreichbar sind. Diese könnte man nun direkt - wie den Entwicklungsrechner auch - an das Firmennetzwerk anschließen&mldr;
&mldr; oder man erstellt für seine Geräte ein eigenes &ldquo;Labornetz&rdquo;, welches nur vom eigenen Laptop aus erreichbar ist und über das man die volle Kontrolle hat. Vorteile können sein:

Überblick über die verbundenen Geräte und ihre IP-Adressen
Keine Exposition der angeschlossenen Geräte ins Firmennetz (Verbesserung der Sicherheit)
Ist am Entwicklungsrechner nur WLAN verfügbar, können die embedded Geräte trotzdem einfach und kabelbunden erreicht werden.

In größeren Unternehmen kann zudem der Zugang zum internen Firmennetzwerk stark reguliert sein, sodass sich überhaupt nur freigeschaltene Geräte nutzen lassen. Mit einem eigenen kleinen Labornetz auf einem zweiten Netzwerkinterface kann das Problem elegant umgangen werden."><link rel=icon type=image/x-icon href=https://blog.zero-iee.com/favicon.ico><link rel=apple-touch-icon-precomposed href=https://blog.zero-iee.com/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=https://blog.zero-iee.com/css/style.min.930d4b2abd5c36f0b4decc538651a976d4e2c8f2f5c29312c354f3ca383468ae.css integrity="sha256-kw1LKr1cNvC03sxThlGpdtTiyPL1wpMSw1Tzyjg0aK4="><script src=https://blog.zero-iee.com/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><meta property="og:title" content="Ein Labornetzwerk unter Linux einrichten"><meta property="og:description" content="Während meiner Arbeit verbinde ich mich regelmäßig zu verschiedenen Rechnern und eingebetteten Geräten, die über eine Ethernetverbindung erreichbar sind. Diese könnte man nun direkt - wie den Entwicklungsrechner auch - an das Firmennetzwerk anschließen&mldr;
&mldr; oder man erstellt für seine Geräte ein eigenes &ldquo;Labornetz&rdquo;, welches nur vom eigenen Laptop aus erreichbar ist und über das man die volle Kontrolle hat. Vorteile können sein:

Überblick über die verbundenen Geräte und ihre IP-Adressen
Keine Exposition der angeschlossenen Geräte ins Firmennetz (Verbesserung der Sicherheit)
Ist am Entwicklungsrechner nur WLAN verfügbar, können die embedded Geräte trotzdem einfach und kabelbunden erreicht werden.

In größeren Unternehmen kann zudem der Zugang zum internen Firmennetzwerk stark reguliert sein, sodass sich überhaupt nur freigeschaltene Geräte nutzen lassen. Mit einem eigenen kleinen Labornetz auf einem zweiten Netzwerkinterface kann das Problem elegant umgangen werden."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.zero-iee.com/posts/labornetzwerk/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-21T12:18:27+02:00"><meta property="article:modified_time" content="2023-07-21T12:18:27+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ein Labornetzwerk unter Linux einrichten"><meta name=twitter:description content="Während meiner Arbeit verbinde ich mich regelmäßig zu verschiedenen Rechnern und eingebetteten Geräten, die über eine Ethernetverbindung erreichbar sind. Diese könnte man nun direkt - wie den Entwicklungsrechner auch - an das Firmennetzwerk anschließen&mldr;
&mldr; oder man erstellt für seine Geräte ein eigenes &ldquo;Labornetz&rdquo;, welches nur vom eigenen Laptop aus erreichbar ist und über das man die volle Kontrolle hat. Vorteile können sein:

Überblick über die verbundenen Geräte und ihre IP-Adressen
Keine Exposition der angeschlossenen Geräte ins Firmennetz (Verbesserung der Sicherheit)
Ist am Entwicklungsrechner nur WLAN verfügbar, können die embedded Geräte trotzdem einfach und kabelbunden erreicht werden.

In größeren Unternehmen kann zudem der Zugang zum internen Firmennetzwerk stark reguliert sein, sodass sich überhaupt nur freigeschaltene Geräte nutzen lassen. Mit einem eigenen kleinen Labornetz auf einem zweiten Netzwerkinterface kann das Problem elegant umgangen werden."></head><body><a class=skip-main href=#main>Zum Hauptinhalt springen</a><div class=container><header class=common-header><div class=header-top><div class=header-logo></div><h1 class=site-title><a href=/>ZERO GmbH Tech Blog</a></h1><ul class=social-icons><li><a href=https://techhub.social/@zeroiee title=Mastodon rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a></li><li><a href=https://github.com/zero-iee title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://de.linkedin.com/company/zero-iee title=Linkedin rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li></ul></div><nav></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Ein Labornetzwerk unter Linux einrichten</h1><span><ul class=post-translations><li>DE</li><li><a href=https://blog.zero-iee.com/en/posts/labornetzwerk/>EN</a></li></ul></span></header></div><div class="content e-content"><p>Während meiner Arbeit verbinde ich mich regelmäßig zu verschiedenen Rechnern und eingebetteten Geräten, die über eine Ethernetverbindung erreichbar sind. Diese könnte man nun direkt - wie den Entwicklungsrechner auch - an das Firmennetzwerk anschließen&mldr;</p><p>&mldr; oder man erstellt für seine Geräte ein eigenes &ldquo;Labornetz&rdquo;, welches nur vom eigenen Laptop aus erreichbar ist und über das man die volle Kontrolle hat. Vorteile können sein:</p><ul><li>Überblick über die verbundenen Geräte und ihre IP-Adressen</li><li>Keine Exposition der angeschlossenen Geräte ins Firmennetz (Verbesserung der Sicherheit)</li><li>Ist am Entwicklungsrechner nur WLAN verfügbar, können die embedded Geräte trotzdem einfach und kabelbunden erreicht werden.</li></ul><p>In größeren Unternehmen kann zudem der Zugang zum internen Firmennetzwerk stark reguliert sein, sodass sich überhaupt nur freigeschaltene Geräte nutzen lassen. Mit einem eigenen kleinen Labornetz auf einem zweiten Netzwerkinterface kann das Problem elegant umgangen werden.</p><h2 id=der-plan>Der Plan
<span><a href=#der-plan><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>Das Labornetz bekommt das IPv4-Netz &ldquo;10.0.0.1/24&rdquo;. IP-Adressen werden vergeben zwischen 10.0.0.10 und 10.0.0.254. Die eigene Entwicklungsrechner soll darin als Router und DNS-Resolver agieren und besitzt die IP-Adresse 10.0.0.1.</p><p>Die Netzwerkparameter auf dem Laborinterface werden in den Netzwerkeinstellungen statisch festgelegt:</p><ul><li>IP-Adresse: 10.0.0.1</li><li>Netzmaske: /24 (255.255.255.0)</li><li>Gateway: 10.0.0.1</li></ul><h2 id=dnsmasq-als-dhcp--und-dns-server-einsetzen>Dnsmasq als DHCP- und DNS-Server einsetzen
<span><a href=#dnsmasq-als-dhcp--und-dns-server-einsetzen><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>Der <code>dnsmasq</code> Server wird genutzt, um einen DHCP- und DNS-Server im Labornetz bereitzustellen. DNS wird benötigt, falls über NAT (siehe letzter Abschnitt) eine Internetverbindung genutzt werden soll.</p><pre><code>sudo apt install dnsmasq
</code></pre><p>In der neuen Konfigurationsdatei<code>/etc/dnsmasq.d/labnet.conf</code> wird <code>dnsmasq</code> konfiguriert:</p><pre><code>listen-address=10.0.0.1
bind-interfaces
dhcp-range=10.0.0.10,10.0.0.254,255.255.255.0,24h
dhcp-option=option:router,10.0.0.1
dhcp-option=option:dns-server,10.0.0.1
</code></pre><p><code>listen-address</code> und <code>bind-interfaces</code> sorgen dafür, dass der mitgelieferte DNS-Resolver nur auf dem Netzwerkinterface horcht, welches die IP-Adresse 10.0.0.1 zugeordnet hat. Lässt man die Option <code>bind-interfaces</code> weg, versucht <code>dnsmasq</code>, auch auf dem localhost Interface einen DNS-Service zu instaltiieren, was auf modernen Linuxdistributionen fehlschlägt, da hier schon <code>systemd-resolved</code> läuft.</p><p>Die neue Config-Datei wird unten in der Datei <code>/etc/dnsmasq.conf</code> noch aktiviert, indem folgende Zeile einkommentiert wird:</p><pre><code>conf-dir=/etc/dnsmasq.d/,*.conf
</code></pre><p>Nach einem Neustart von <code>dnsmasq</code> ziehen sich Geräte, die nur am Laborinterface angesteckt werden, eine IP-Adresse via DHCP und sollten von der Entwicklungsrechner aus erreichbar sein. Welche IP-Adresse ein Gerät bekommen hat, lässt sich im <code>dnsmasq</code> Log nachvollziehen:</p><pre><code>sudo journalctl -u dnsmasq -f
</code></pre><h2 id=eine-temporäre-internetverbindung-bereitstellen>Eine (temporäre) Internetverbindung bereitstellen
<span><a href=#eine-tempor%c3%a4re-internetverbindung-bereitstellen><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>Damit angeschlossene Geräte für Softwareinstallationen und Updates einen Weg ins Internet finden, kann auf der Entwicklungsrechner ein Source-NAT eingerichtet werden. Ich nutze hierfür ein kleines Script:</p><pre><code>#!/bin/bash

EXT_IFACE=ens33 # ens33 = interface to public network
INT_IFACE=ens37 # ens37 = interface to lab network

if [[ &quot;$1&quot; == &quot;start&quot; ]]; then
        echo &quot;Starting NAT ...&quot;
        sudo sh -c &quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;
        sudo iptables --table nat --append POSTROUTING --out-interface $EXT_IFACE -j MASQUERADE
        sudo iptables --append FORWARD --in-interface $INT_IFACE -j ACCEPT
else
        echo &quot;Stopping NAT ...&quot;
        sudo iptables --table nat --delete POSTROUTING --out-interface $EXT_IFACE -j MASQUERADE
        sudo iptables --delete FORWARD --in-interface $INT_IFACE -j ACCEPT
fi
</code></pre><p><em>(Wichtig: Interfacebezeichnungen <code>ens33</code> bzw <code>ens37</code> anpassen via Variablen EXT_IFACE und INT_IFACE!)*</em></p><p>Das Script wird unter <code>~/.local/bin/natctl</code> abgespeichert und im PATH bekannt gemacht:</p><p><code>~/.bashrc</code>:</p><pre><code>export PATH=$PATH:~/.local/bin
</code></pre><p>Außerdem wird das Script ausführbar gemacht:</p><pre><code>chmod u+x  ~/.local/bin/netctl
</code></pre><p>Nach einem <code>source ~/.bashrc</code> sollte das <code>natctl</code> Script verfügbar sein. Über zwei einfache Kommandos kann die Internetverbindung dann aktiviert bzw. deaktiviert werden:</p><pre><code>natctl start
natctl stop
</code></pre><p><em>Hinweis: Nach einem Reboot muss der <code>dnsmasq</code> Server evtl. neu gestartet werden, da das Laborinterface zum ersten Startversuch möglicherweise noch nicht die passende IP-Adresse hatte und dieser deshalb fehlgeschlagen sein könnte. Sollten neu angesteckte Geräte also keine IP-Adresse bekommen, lohnt es sich, einmal einen Neustart via <code>sudo systemctl restart dnsmasq</code> zu versuchen.</em></p><p><em>Hinweis 2: Auch die NAT-Funktion überlebt (absichtlich) keinen Neustart. Nach dem Booten muss das NAT mittels <code>natctl start</code> wieder aktiviert werden.</em></p></div><div class=post-info>Von Thomas Leister<div class="post-date dt-published">2023-07-21</div><a class="post-hidden-url u-url" href=https://blog.zero-iee.com/posts/labornetzwerk/>https://blog.zero-iee.com/posts/labornetzwerk/</a>
<a href=https://blog.zero-iee.com class="p-name p-author post-hidden-author h-card" rel=me>Thomas Leister</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://blog.zero-iee.com/tags/embedded/>#embedded</a></li><li><a href=https://blog.zero-iee.com/tags/netzwerk/>#netzwerk</a></li><li><a href=https://blog.zero-iee.com/tags/linux/>#linux</a></li></ul></div></div></article></main><footer class=common-footer><ul class=language-select><li>Deutsch</li><li><a href=https://blog.zero-iee.com/en/posts/labornetzwerk/>English</a></li></ul><div class=common-footer-bottom><div class=copyright><p>© ZERO GmbH, ZERO GmbH Team, 2023 | <a href=/impressum/>Impressum</a> | <a href=/datenschutz/>Datenschutz</a><br>Erstellt mit <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, Markdown and Git<br>Theme <a target=_blank rel="noopener noreferrer" href=https://github.com/zero-iee/hugo-theme-anubis-zero>Anubis ZERO</a> basierend auf <a href=https://github.com/Mitrichius/hugo-theme-anubis>Mitrichius/hugo-theme-anubis</a>.<br></p></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="dark-without-switcher";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton&&(switchButton.textContent=currentTheme=="dark"?"Helles Theme":"Dunkles Theme")}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href=https://blog.zero-iee.com class="p-name u-url url fn" rel=me>ZERO GmbH Team</a></p></footer><a rel=me href=https://techhub.social/@zeroiee style=display:none>Mastodon</a></div></body></html>