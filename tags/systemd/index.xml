<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Systemd on ZERO GmbH Tech Blog</title><link>https://blog.zero-iee.com/tags/systemd/</link><description>ZERO GmbH Tech Blog (Systemd)</description><generator>Hugo -- gohugo.io</generator><language>de</language><lastBuildDate>Fri, 06 Sep 2024 17:33:54 +0200</lastBuildDate><atom:link href="https://blog.zero-iee.com/tags/systemd/index.xml" rel="self" type="application/rss+xml"/><item><title>Dnsmasq startet nicht wegen belegtem Port 53</title><link>https://blog.zero-iee.com/posts/dnsmasq-startup-error-with-systemd-resolved/</link><pubDate>Fri, 06 Sep 2024 17:33:54 +0200</pubDate><guid>https://blog.zero-iee.com/posts/dnsmasq-startup-error-with-systemd-resolved/</guid><description>&lt;p>Vielleicht ist der ein oder andere auch schon einmal in das Problem gelaufen, als Dnsmasq als separater DNS/DHCP Server auf einem Host mit einem extra Netzwerkinterface eingesetzt werden sollte:&lt;/p>
&lt;pre tabindex="0">&lt;code>$ sudo systemctl status dnsmasq
[...]
Sep 06 14:32:22 office-gateway dnsmasq[830]: failed to create listening socket for port 53: Address already in use
Sep 06 14:32:22 office-gateway dnsmasq[830]: FAILED to start up
Sep 06 14:32:22 office-gateway systemd[1]: dnsmasq.service: Control process exited, code=exited, status=2/INVALIDARGUMENT
Sep 06 14:32:22 office-gateway systemd[1]: dnsmasq.service: Failed with result &amp;#39;exit-code&amp;#39;.
Sep 06 14:32:22 office-gateway systemd[1]: Failed to start dnsmasq.service - dnsmasq - A lightweight DHCP and caching DNS server.
[...]
&lt;/code>&lt;/pre>&lt;p>Die Ursache war uns - dachten wir - schnell klar, denn auf dem fraglichen Ubuntu Server System befindet sich an Werk bereits der lokale &lt;code>systemd-resolved&lt;/code> Resolver, der auf Port 53 bereits hervorragende Leiste leistet. Der Dnsmasq-Service, der neben DHCP auch einen DNS-Service auf Port 53 anbieten will, kann den Port so nicht mehr an sich reißen.&lt;/p>
&lt;p>Wir dachten, durch eine Ausnahme bei den Netzwerkinterfaces könnten wir das Problem umgehen, denn über &lt;code>except-interface&lt;/code> können für Dnsmasq Interfaces angegeben werden, die ignoriert werden sollen. Datei &lt;code>/etc/dnsmasq.conf&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>except-interface=lo
&lt;/code>&lt;/pre>&lt;p>doch das hat nichts genützt. Das Problem bestand noch immer.&lt;/p>
&lt;p>Schließlich sind wir in &lt;code>/etc/defaults/dnsmasq&lt;/code> auf eine Option aufmerksam geworden, die Dnsmasq veranlasst, sämtliche lokale Schnittstellen außer Acht zu lassen:&lt;/p>
&lt;pre tabindex="0">&lt;code># If the resolvconf package is installed, dnsmasq will tell resolvconf
# to use dnsmasq under 127.0.0.1 as the system&amp;#39;s default resolver.
# Uncommenting this line inhibits this behaviour.
DNSMASQ_EXCEPT=&amp;#34;lo&amp;#34;
&lt;/code>&lt;/pre>&lt;p>Die Option muss - wie dargestellt - einkommentiert werden, damit sie aktiv wird. Nach einem Neustart des &lt;code>dnsmasq&lt;/code> Services kommen sich die beiden DNS-Services nicht mehr in die Quere.
Wir haben uns zusätzlich dazu entschieden, Dnsmasq explizit nur auf dem gewünschten Interface zu aktivieren. Datei &lt;code>/etc/dnsmasq.conf&lt;/code>:&lt;/p>
&lt;pre tabindex="0">&lt;code>interface=enp0s31f6
&lt;/code>&lt;/pre>&lt;p>&lt;em>(diese Maßnahme alleine führte übrigens auch nicht zum Erfolg - DNSMASQ_EXCEPT=&amp;ldquo;lo&amp;rdquo; scheint dennoch notwendig zu sein.)&lt;/em>&lt;/p></description></item></channel></rss>